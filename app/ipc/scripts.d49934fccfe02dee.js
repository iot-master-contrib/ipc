!function(N){"object"==typeof exports&&typeof module<"u"?module.exports=N():"function"==typeof define&&define.amd?define([],N):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).adapter=N()}(function(){return function R(D,v,b){function s(a,f){if(!v[a]){if(!D[a]){var C="function"==typeof require&&require;if(!f&&C)return C(a,!0);if(n)return n(a,!0);var P=new Error("Cannot find module '"+a+"'");throw P.code="MODULE_NOT_FOUND",P}var _=v[a]={exports:{}};D[a][0].call(_.exports,function(E){return s(D[a][1][E]||E)},_,_.exports,R,D,v,b)}return v[a].exports}for(var n="function"==typeof require&&require,i=0;i<b.length;i++)s(b[i]);return s}({1:[function(R,D,v){"use strict";var s=(0,R("./adapter_factory.js").adapterFactory)({window:typeof window>"u"?void 0:window});D.exports=s},{"./adapter_factory.js":2}],2:[function(R,D,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.adapterFactory=function d(){var r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},o=s.log,e=s.detectBrowser(r),c={browserDetails:e,commonShim:E,extractVersion:s.extractVersion,disableLog:s.disableLog,disableWarnings:s.disableWarnings,sdp:x};switch(e.browser){case"chrome":if(!i||!i.shimPeerConnection||!t.shimChrome)return o("Chrome shim is not included in this adapter release."),c;if(null===e.version)return o("Chrome shim can not determine version, not shimming."),c;o("adapter.js shimming chrome."),c.browserShim=i,E.shimAddIceCandidateNullOrEmpty(r,e),E.shimParameterlessSetLocalDescription(r,e),i.shimGetUserMedia(r,e),i.shimMediaStream(r,e),i.shimPeerConnection(r,e),i.shimOnTrack(r,e),i.shimAddTrackRemoveTrack(r,e),i.shimGetSendersWithDtmf(r,e),i.shimGetStats(r,e),i.shimSenderReceiverGetStats(r,e),i.fixNegotiationNeeded(r,e),E.shimRTCIceCandidate(r,e),E.shimRTCIceCandidateRelayProtocol(r,e),E.shimConnectionState(r,e),E.shimMaxMessageSize(r,e),E.shimSendThrowTypeError(r,e),E.removeExtmapAllowMixed(r,e);break;case"firefox":if(!f||!f.shimPeerConnection||!t.shimFirefox)return o("Firefox shim is not included in this adapter release."),c;o("adapter.js shimming firefox."),c.browserShim=f,E.shimAddIceCandidateNullOrEmpty(r,e),E.shimParameterlessSetLocalDescription(r,e),f.shimGetUserMedia(r,e),f.shimPeerConnection(r,e),f.shimOnTrack(r,e),f.shimRemoveStream(r,e),f.shimSenderGetStats(r,e),f.shimReceiverGetStats(r,e),f.shimRTCDataChannel(r,e),f.shimAddTransceiver(r,e),f.shimGetParameters(r,e),f.shimCreateOffer(r,e),f.shimCreateAnswer(r,e),E.shimRTCIceCandidate(r,e),E.shimConnectionState(r,e),E.shimMaxMessageSize(r,e),E.shimSendThrowTypeError(r,e);break;case"safari":if(!P||!t.shimSafari)return o("Safari shim is not included in this adapter release."),c;o("adapter.js shimming safari."),c.browserShim=P,E.shimAddIceCandidateNullOrEmpty(r,e),E.shimParameterlessSetLocalDescription(r,e),P.shimRTCIceServerUrls(r,e),P.shimCreateOfferLegacy(r,e),P.shimCallbacksAPI(r,e),P.shimLocalStreamsAPI(r,e),P.shimRemoteStreamsAPI(r,e),P.shimTrackEventTransceiver(r,e),P.shimGetUserMedia(r,e),P.shimAudioContext(r,e),E.shimRTCIceCandidate(r,e),E.shimRTCIceCandidateRelayProtocol(r,e),E.shimMaxMessageSize(r,e),E.shimSendThrowTypeError(r,e),E.removeExtmapAllowMixed(r,e);break;default:o("Unsupported browser!")}return c};var s=I(R("./utils")),i=I(R("./chrome/chrome_shim")),f=I(R("./firefox/firefox_shim")),P=I(R("./safari/safari_shim")),E=I(R("./common_shim")),x=I(R("sdp"));function I(S){if(S&&S.__esModule)return S;var r={};if(null!=S)for(var t in S)Object.prototype.hasOwnProperty.call(S,t)&&(r[t]=S[t]);return r.default=S,r}},{"./chrome/chrome_shim":3,"./common_shim":6,"./firefox/firefox_shim":7,"./safari/safari_shim":10,"./utils":11,sdp:12}],3:[function(R,D,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.shimGetDisplayMedia=v.shimGetUserMedia=void 0;var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=R("./getusermedia");Object.defineProperty(v,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}});var n=R("./getdisplaymedia");Object.defineProperty(v,"shimGetDisplayMedia",{enumerable:!0,get:function(){return n.shimGetDisplayMedia}}),v.shimMediaStream=function P(t){t.MediaStream=t.MediaStream||t.webkitMediaStream},v.shimOnTrack=function _(t){if("object"===(typeof t>"u"?"undefined":b(t))&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(c){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=c)},enumerable:!0,configurable:!0});var o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var c=this;return this._ontrackpoly||(this._ontrackpoly=function(u){u.stream.addEventListener("addtrack",function(m){var p;p=t.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(h){return h.track&&h.track.id===m.track.id}):{track:m.track};var l=new Event("track");l.track=m.track,l.receiver=p,l.transceiver={receiver:p},l.streams=[u.stream],c.dispatchEvent(l)}),u.stream.getTracks().forEach(function(m){var p;p=t.RTCPeerConnection.prototype.getReceivers?c.getReceivers().find(function(h){return h.track&&h.track.id===m.id}):{track:m};var l=new Event("track");l.track=m,l.receiver=p,l.transceiver={receiver:p},l.streams=[u.stream],c.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),o.apply(this,arguments)}}else a.wrapPeerConnectionEvent(t,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e})},v.shimGetSendersWithDtmf=function E(t){if("object"===(typeof t>"u"?"undefined":b(t))&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){var o=function(h,y){return{track:y,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===y.kind?h.createDTMFSender(y):null),this._dtmf},_pc:h}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,y){var g=e.apply(this,arguments);return g||(g=o(this,h),this._senders.push(g)),g};var c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){c.apply(this,arguments);var y=this._senders.indexOf(h);-1!==y&&this._senders.splice(y,1)}}var u=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(h){var y=this;this._senders=this._senders||[],u.apply(this,[h]),h.getTracks().forEach(function(g){y._senders.push(o(y,g))})};var m=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(h){var y=this;this._senders=this._senders||[],m.apply(this,[h]),h.getTracks().forEach(function(g){var M=y._senders.find(function(k){return k.track===g});M&&y._senders.splice(y._senders.indexOf(M),1)})}}else if("object"===(typeof t>"u"?"undefined":b(t))&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){var p=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){var h=this,y=p.apply(this,[]);return y.forEach(function(g){return g._pc=h}),y},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}},v.shimGetStats=function L(t){if(t.RTCPeerConnection){var o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){var c=this,u=Array.prototype.slice.call(arguments),m=u[0],p=u[1],l=u[2];if(arguments.length>0&&"function"==typeof m)return o.apply(this,arguments);if(0===o.length&&(0===arguments.length||"function"!=typeof m))return o.apply(this,[]);var h=function(k){var O={};return k.result().forEach(function(G){var F={id:G.id,timestamp:G.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[G.type]||G.type};G.names().forEach(function(z){F[z]=G.stat(z)}),O[F.id]=F}),O},y=function(k){return new Map(Object.keys(k).map(function(O){return[O,k[O]]}))};return arguments.length>=2?o.apply(this,[function(k){p(y(h(k)))},m]):new Promise(function(M,k){o.apply(c,[function(O){M(y(h(O)))},k])}).then(p,l)}}},v.shimSenderReceiverGetStats=function x(t){if("object"===(typeof t>"u"?"undefined":b(t))&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver){if(!("getStats"in t.RTCRtpSender.prototype)){var o=t.RTCPeerConnection.prototype.getSenders;o&&(t.RTCPeerConnection.prototype.getSenders=function(){var p=this,l=o.apply(this,[]);return l.forEach(function(h){return h._pc=p}),l});var e=t.RTCPeerConnection.prototype.addTrack;e&&(t.RTCPeerConnection.prototype.addTrack=function(){var p=e.apply(this,arguments);return p._pc=this,p}),t.RTCRtpSender.prototype.getStats=function(){var p=this;return this._pc.getStats().then(function(l){return a.filterStats(l,p.track,!0)})}}if(!("getStats"in t.RTCRtpReceiver.prototype)){var c=t.RTCPeerConnection.prototype.getReceivers;c&&(t.RTCPeerConnection.prototype.getReceivers=function(){var p=this,l=c.apply(this,[]);return l.forEach(function(h){return h._pc=p}),l}),a.wrapPeerConnectionEvent(t,"track",function(m){return m.receiver._pc=m.srcElement,m}),t.RTCRtpReceiver.prototype.getStats=function(){var p=this;return this._pc.getStats().then(function(l){return a.filterStats(l,p.track,!1)})}}if("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype){var u=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){var p=arguments[0],l=void 0,h=void 0,y=void 0;return this.getSenders().forEach(function(g){g.track===p&&(l?y=!0:l=g)}),this.getReceivers().forEach(function(g){return g.track===p&&(h?y=!0:h=g),g.track===p}),y||l&&h?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):l?l.getStats():h?h.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return u.apply(this,arguments)}}}},v.shimAddTrackRemoveTrackWithNative=I,v.shimAddTrackRemoveTrack=function d(t,o){if(t.RTCPeerConnection){if(t.RTCPeerConnection.prototype.addTrack&&o.version>=65)return I(t);var e=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){var g=this,M=e.apply(this);return this._reverseStreams=this._reverseStreams||{},M.map(function(k){return g._reverseStreams[k.id]})};var c=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(g){var M=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(function(O){if(M.getSenders().find(function(G){return G.track===O}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){var k=new t.MediaStream(g.getTracks());this._streams[g.id]=k,this._reverseStreams[k.id]=g,g=k}c.apply(this,[g])};var u=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},t.RTCPeerConnection.prototype.addTrack=function(g,M){var k=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var O=[].slice.call(arguments,1);if(1!==O.length||!O[0].getTracks().find(function(z){return z===g}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(z){return z.track===g}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var G=this._streams[M.id];if(G)G.addTrack(g),Promise.resolve().then(function(){k.dispatchEvent(new Event("negotiationneeded"))});else{var F=new t.MediaStream([g]);this._streams[M.id]=F,this._reverseStreams[F.id]=M,this.addStream(F)}return this.getSenders().find(function(z){return z.track===g})},["createOffer","createAnswer"].forEach(function(y){var g=t.RTCPeerConnection.prototype[y],M=C({},y,function(){var k=this,O=arguments;return arguments.length&&"function"==typeof arguments[0]?g.apply(this,[function(G){var F=m(k,G);O[0].apply(null,[F])},function(G){O[1]&&O[1].apply(null,G)},arguments[2]]):g.apply(this,arguments).then(function(G){return m(k,G)})});t.RTCPeerConnection.prototype[y]=M[y]});var l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function p(y,g){var M=g.sdp;return Object.keys(y._reverseStreams||[]).forEach(function(k){var O=y._reverseStreams[k],U=y._streams[O.id];M=M.replace(new RegExp(O.id,"g"),U.id)}),new RTCSessionDescription({type:g.type,sdp:M})}(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};var h=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get:function(){var g=h.get.apply(this);return""===g.type?g:m(this,g)}}),t.RTCPeerConnection.prototype.removeTrack=function(g){var M=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var O=void 0;Object.keys(this._streams).forEach(function(U){M._streams[U].getTracks().find(function(F){return g.track===F})&&(O=M._streams[U])}),O&&(1===O.getTracks().length?this.removeStream(this._reverseStreams[O.id]):O.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function m(y,g){var M=g.sdp;return Object.keys(y._reverseStreams||[]).forEach(function(k){var O=y._reverseStreams[k];M=M.replace(new RegExp(y._streams[O.id].id,"g"),O.id)}),new RTCSessionDescription({type:g.type,sdp:M})}},v.shimPeerConnection=function S(t,o){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&o.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var c=t.RTCPeerConnection.prototype[e],u=C({},e,function(){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)});t.RTCPeerConnection.prototype[e]=u[e]})},v.fixNegotiationNeeded=function r(t,o){a.wrapPeerConnectionEvent(t,"negotiationneeded",function(e){var c=e.target;if(!(o.version<72||c.getConfiguration&&"plan-b"===c.getConfiguration().sdpSemantics)||"stable"===c.signalingState)return e})};var a=function f(t){if(t&&t.__esModule)return t;var o={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(o[e]=t[e]);return o.default=t,o}(R("../utils.js"));function C(t,o,e){return o in t?Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[o]=e,t}function I(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){var p=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(l){return p._shimmedLocalStreams[l][0]})};var o=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(p,l){if(!l)return o.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var h=o.apply(this,arguments);return this._shimmedLocalStreams[l.id]?-1===this._shimmedLocalStreams[l.id].indexOf(h)&&this._shimmedLocalStreams[l.id].push(h):this._shimmedLocalStreams[l.id]=[l,h],h};var e=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(p){var l=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},p.getTracks().forEach(function(g){if(l.getSenders().find(function(k){return k.track===g}))throw new DOMException("Track already exists.","InvalidAccessError")});var h=this.getSenders();e.apply(this,arguments);var y=this.getSenders().filter(function(g){return-1===h.indexOf(g)});this._shimmedLocalStreams[p.id]=[p].concat(y)};var c=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(p){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[p.id],c.apply(this,arguments)};var u=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(p){var l=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},p&&Object.keys(this._shimmedLocalStreams).forEach(function(h){var y=l._shimmedLocalStreams[h].indexOf(p);-1!==y&&l._shimmedLocalStreams[h].splice(y,1),1===l._shimmedLocalStreams[h].length&&delete l._shimmedLocalStreams[h]}),u.apply(this,arguments)}}},{"../utils.js":11,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(R,D,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.shimGetDisplayMedia=function b(s,n){if((!s.navigator.mediaDevices||!("getDisplayMedia"in s.navigator.mediaDevices))&&s.navigator.mediaDevices){if("function"!=typeof n)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");s.navigator.mediaDevices.getDisplayMedia=function(a){return n(a).then(function(f){var C=a.video&&a.video.width,P=a.video&&a.video.height;return a.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:f,maxFrameRate:a.video&&a.video.frameRate||3}},C&&(a.video.mandatory.maxWidth=C),P&&(a.video.mandatory.maxHeight=P),s.navigator.mediaDevices.getUserMedia(a)})}}}},{}],5:[function(R,D,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(C){return typeof C}:function(C){return C&&"function"==typeof Symbol&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C};v.shimGetUserMedia=function f(C,P){var _=C&&C.navigator;if(_.mediaDevices){var E=function(r){if("object"!==(typeof r>"u"?"undefined":b(r))||r.mandatory||r.optional)return r;var t={};return Object.keys(r).forEach(function(o){if("require"!==o&&"advanced"!==o&&"mediaSource"!==o){var e="object"===b(r[o])?r[o]:{ideal:r[o]};void 0!==e.exact&&"number"==typeof e.exact&&(e.min=e.max=e.exact);var c=function(p,l){return p?p+l.charAt(0).toUpperCase()+l.slice(1):"deviceId"===l?"sourceId":l};if(void 0!==e.ideal){t.optional=t.optional||[];var u={};"number"==typeof e.ideal?(u[c("min",o)]=e.ideal,t.optional.push(u),(u={})[c("max",o)]=e.ideal,t.optional.push(u)):(u[c("",o)]=e.ideal,t.optional.push(u))}void 0!==e.exact&&"number"!=typeof e.exact?(t.mandatory=t.mandatory||{},t.mandatory[c("",o)]=e.exact):["min","max"].forEach(function(m){void 0!==e[m]&&(t.mandatory=t.mandatory||{},t.mandatory[c(m,o)]=e[m])})}}),r.advanced&&(t.optional=(t.optional||[]).concat(r.advanced)),t},L=function(r,t){if(P.version>=61)return t(r);if((r=JSON.parse(JSON.stringify(r)))&&"object"===b(r.audio)){var o=function(p,l,h){l in p&&!(h in p)&&(p[h]=p[l],delete p[l])};o((r=JSON.parse(JSON.stringify(r))).audio,"autoGainControl","googAutoGainControl"),o(r.audio,"noiseSuppression","googNoiseSuppression"),r.audio=E(r.audio)}if(r&&"object"===b(r.video)){var e=r.video.facingMode;e=e&&("object"===(typeof e>"u"?"undefined":b(e))?e:{ideal:e});var c=P.version<66;if(e&&("user"===e.exact||"environment"===e.exact||"user"===e.ideal||"environment"===e.ideal)&&(!_.mediaDevices.getSupportedConstraints||!_.mediaDevices.getSupportedConstraints().facingMode||c)){delete r.video.facingMode;var u=void 0;if("environment"===e.exact||"environment"===e.ideal?u=["back","rear"]:("user"===e.exact||"user"===e.ideal)&&(u=["front"]),u)return _.mediaDevices.enumerateDevices().then(function(m){var p=(m=m.filter(function(l){return"videoinput"===l.kind})).find(function(l){return u.some(function(h){return l.label.toLowerCase().includes(h)})});return!p&&m.length&&u.includes("back")&&(p=m[m.length-1]),p&&(r.video.deviceId=e.exact?{exact:p.deviceId}:{ideal:p.deviceId}),r.video=E(r.video),a("chrome: "+JSON.stringify(r)),t(r)})}r.video=E(r.video)}return a("chrome: "+JSON.stringify(r)),t(r)},x=function(r){return P.version>=64?r:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[r.name]||r.name,message:r.message,constraint:r.constraint||r.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(_.getUserMedia=function(r,t,o){L(r,function(e){_.webkitGetUserMedia(e,t,function(c){o&&o(x(c))})})}.bind(_),_.mediaDevices.getUserMedia){var d=_.mediaDevices.getUserMedia.bind(_.mediaDevices);_.mediaDevices.getUserMedia=function(S){return L(S,function(r){return d(r).then(function(t){if(r.audio&&!t.getAudioTracks().length||r.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(o){o.stop()}),new DOMException("","NotFoundError");return t},function(t){return Promise.reject(x(t))})})}}}};var a=function i(C){if(C&&C.__esModule)return C;var P={};if(null!=C)for(var _ in C)Object.prototype.hasOwnProperty.call(C,_)&&(P[_]=C[_]);return P.default=C,P}(R("../utils.js")).log},{"../utils.js":11}],6:[function(R,D,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r};v.shimRTCIceCandidate=function P(r){if(!(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)){var t=r.RTCIceCandidate;r.RTCIceCandidate=function(e){if("object"===(typeof e>"u"?"undefined":b(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var c=new t(e),u=n.default.parseCandidate(e.candidate),m=Object.assign(c,u);return m.toJSON=function(){return{candidate:m.candidate,sdpMid:m.sdpMid,sdpMLineIndex:m.sdpMLineIndex,usernameFragment:m.usernameFragment}},m}return new t(e)},r.RTCIceCandidate.prototype=t.prototype,a.wrapPeerConnectionEvent(r,"icecandidate",function(o){return o.candidate&&Object.defineProperty(o,"candidate",{value:new r.RTCIceCandidate(o.candidate),writable:"false"}),o})}},v.shimRTCIceCandidateRelayProtocol=function _(r){!r.RTCIceCandidate||r.RTCIceCandidate&&"relayProtocol"in r.RTCIceCandidate.prototype||a.wrapPeerConnectionEvent(r,"icecandidate",function(t){if(t.candidate){var o=n.default.parseCandidate(t.candidate.candidate);"relay"===o.type&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[o.priority>>24])}return t})},v.shimMaxMessageSize=function E(r,t){if(r.RTCPeerConnection){"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get:function(){return typeof this._sctp>"u"?null:this._sctp}});var o=function(l){if(!l||!l.sdp)return!1;var h=n.default.splitSections(l.sdp);return h.shift(),h.some(function(y){var g=n.default.parseMLine(y);return g&&"application"===g.kind&&-1!==g.protocol.indexOf("SCTP")})},e=function(l){var h=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===h||h.length<2)return-1;var y=parseInt(h[1],10);return y!=y?-1:y},c=function(l){var h=65536;return"firefox"===t.browser&&(h=t.version<57?-1===l?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),h},u=function(l,h){var y=65536;"firefox"===t.browser&&57===t.version&&(y=65535);var g=n.default.matchPrefix(l.sdp,"a=max-message-size:");return g.length>0?y=parseInt(g[0].substr(19),10):"firefox"===t.browser&&-1!==h&&(y=2147483637),y},m=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0}),o(arguments[0])){var k,y=e(arguments[0]),g=c(y),M=u(arguments[0],y);k=0===g&&0===M?Number.POSITIVE_INFINITY:0===g||0===M?Math.max(g,M):Math.min(g,M);var O={};Object.defineProperty(O,"maxMessageSize",{get:function(){return k}}),this._sctp=O}return m.apply(this,arguments)}}},v.shimSendThrowTypeError=function L(r){if(r.RTCPeerConnection&&"createDataChannel"in r.RTCPeerConnection.prototype){var o=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){var c=o.apply(this,arguments);return t(c,this),c},a.wrapPeerConnectionEvent(r,"datachannel",function(e){return t(e.channel,e.target),e})}function t(e,c){var u=e.send;e.send=function(){var p=arguments[0];if("open"===e.readyState&&c.sctp&&(p.length||p.size||p.byteLength)>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(e,arguments)}}},v.shimConnectionState=function x(r){if(r.RTCPeerConnection&&!("connectionState"in r.RTCPeerConnection.prototype)){var t=r.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(o){var e=t[o];t[o]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(c){var u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;var m=new Event("connectionstatechange",c);u.dispatchEvent(m)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),e.apply(this,arguments)}})}},v.removeExtmapAllowMixed=function I(r,t){if(r.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71)&&!("safari"===t.browser&&t.version>=605)){var o=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(c){if(c&&c.sdp&&-1!==c.sdp.indexOf("\na=extmap-allow-mixed")){var u=c.sdp.split("\n").filter(function(m){return"a=extmap-allow-mixed"!==m.trim()}).join("\n");r.RTCSessionDescription&&c instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:c.type,sdp:u}):c.sdp=u}return o.apply(this,arguments)}}},v.shimAddIceCandidateNullOrEmpty=function d(r,t){if(r.RTCPeerConnection&&r.RTCPeerConnection.prototype){var o=r.RTCPeerConnection.prototype.addIceCandidate;!o||0===o.length||(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}},v.shimParameterlessSetLocalDescription=function S(r,t){if(r.RTCPeerConnection&&r.RTCPeerConnection.prototype){var o=r.RTCPeerConnection.prototype.setLocalDescription;!o||0===o.length||(r.RTCPeerConnection.prototype.setLocalDescription=function(){var c=this,u=arguments[0]||{};if("object"!==(typeof u>"u"?"undefined":b(u))||u.type&&u.sdp)return o.apply(this,arguments);if(!(u={type:u.type,sdp:u.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":u.type="offer";break;default:u.type="answer"}return u.sdp||"offer"!==u.type&&"answer"!==u.type?o.apply(this,[u]):("offer"===u.type?this.createOffer:this.createAnswer).apply(this).then(function(p){return o.apply(c,[p])})})}};var n=function C(r){return r&&r.__esModule?r:{default:r}}(R("sdp")),a=function f(r){if(r&&r.__esModule)return r;var t={};if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t.default=r,t}(R("./utils"))},{"./utils":11,sdp:12}],7:[function(R,D,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.shimGetDisplayMedia=v.shimGetUserMedia=void 0;var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=R("./getusermedia");Object.defineProperty(v,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}});var n=R("./getdisplaymedia");Object.defineProperty(v,"shimGetDisplayMedia",{enumerable:!0,get:function(){return n.shimGetDisplayMedia}}),v.shimOnTrack=function _(e){"object"===(typeof e>"u"?"undefined":b(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},v.shimPeerConnection=function E(e,c){if("object"===(typeof e>"u"?"undefined":b(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),c.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(p){var l=e.RTCPeerConnection.prototype[p],h=function P(e,c,u){return c in e?Object.defineProperty(e,c,{value:u,enumerable:!0,configurable:!0,writable:!0}):e[c]=u,e}({},p,function(){return arguments[0]=new("addIceCandidate"===p?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)});e.RTCPeerConnection.prototype[p]=h[p]});var u={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},m=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var l=Array.prototype.slice.call(arguments),y=l[1],g=l[2];return m.apply(this,[l[0]||null]).then(function(M){if(c.version<53&&!y)try{M.forEach(function(k){k.type=u[k.type]||k.type})}catch(k){if("TypeError"!==k.name)throw k;M.forEach(function(O,U){M.set(U,Object.assign({},O,{type:u[O.type]||O.type}))})}return M}).then(y,g)}}},v.shimSenderGetStats=function L(e){if("object"===(typeof e>"u"?"undefined":b(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var c=e.RTCPeerConnection.prototype.getSenders;c&&(e.RTCPeerConnection.prototype.getSenders=function(){var p=this,l=c.apply(this,[]);return l.forEach(function(h){return h._pc=p}),l});var u=e.RTCPeerConnection.prototype.addTrack;u&&(e.RTCPeerConnection.prototype.addTrack=function(){var p=u.apply(this,arguments);return p._pc=this,p}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},v.shimReceiverGetStats=function x(e){if("object"===(typeof e>"u"?"undefined":b(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var c=e.RTCPeerConnection.prototype.getReceivers;c&&(e.RTCPeerConnection.prototype.getReceivers=function(){var m=this,p=c.apply(this,[]);return p.forEach(function(l){return l._pc=m}),p}),a.wrapPeerConnectionEvent(e,"track",function(u){return u.receiver._pc=u.srcElement,u}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},v.shimRemoveStream=function I(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(u){var m=this;a.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(p){p.track&&u.getTracks().includes(p.track)&&m.removeTrack(p)})})},v.shimRTCDataChannel=function d(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},v.shimAddTransceiver=function S(e){if("object"===(typeof e>"u"?"undefined":b(e))&&e.RTCPeerConnection){var c=e.RTCPeerConnection.prototype.addTransceiver;c&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var m=arguments[1]&&arguments[1].sendEncodings;void 0===m&&(m=[]),m=[].concat(function C(e){if(Array.isArray(e)){for(var c=0,u=Array(e.length);c<e.length;c++)u[c]=e[c];return u}return Array.from(e)}(m));var p=m.length>0;p&&m.forEach(function(g){if("rid"in g&&!/^[a-z0-9]{0,16}$/i.test(g.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in g&&!(parseFloat(g.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in g&&!(parseFloat(g.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var l=c.apply(this,arguments);if(p){var h=l.sender,y=h.getParameters();(!("encodings"in y)||1===y.encodings.length&&0===Object.keys(y.encodings[0]).length)&&(y.encodings=m,h.sendEncodings=m,this.setParametersPromises.push(h.setParameters(y).then(function(){delete h.sendEncodings}).catch(function(){delete h.sendEncodings})))}return l})}},v.shimGetParameters=function r(e){if("object"===(typeof e>"u"?"undefined":b(e))&&e.RTCRtpSender){var c=e.RTCRtpSender.prototype.getParameters;c&&(e.RTCRtpSender.prototype.getParameters=function(){var m=c.apply(this,arguments);return"encodings"in m||(m.encodings=[].concat(this.sendEncodings||[{}])),m})}},v.shimCreateOffer=function t(e){if("object"===(typeof e>"u"?"undefined":b(e))&&e.RTCPeerConnection){var c=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var m=this,p=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return c.apply(m,p)}).finally(function(){m.setParametersPromises=[]}):c.apply(this,arguments)}}},v.shimCreateAnswer=function o(e){if("object"===(typeof e>"u"?"undefined":b(e))&&e.RTCPeerConnection){var c=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var m=this,p=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return c.apply(m,p)}).finally(function(){m.setParametersPromises=[]}):c.apply(this,arguments)}}};var a=function f(e){if(e&&e.__esModule)return e;var c={};if(null!=e)for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&(c[u]=e[u]);return c.default=e,c}(R("../utils"))},{"../utils":11,"./getdisplaymedia":8,"./getusermedia":9}],8:[function(R,D,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.shimGetDisplayMedia=function b(s,n){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(a){if(!a||!a.video){var f=new DOMException("getDisplayMedia without video constraints is undefined");return f.name="NotFoundError",f.code=8,Promise.reject(f)}return!0===a.video?a.video={mediaSource:n}:a.video.mediaSource=n,s.navigator.mediaDevices.getUserMedia(a)})}},{}],9:[function(R,D,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(f){return typeof f}:function(f){return f&&"function"==typeof Symbol&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f};v.shimGetUserMedia=function a(f,C){var P=f&&f.navigator,_=f&&f.MediaStreamTrack;if(P.getUserMedia=function(d,S,r){n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),P.mediaDevices.getUserMedia(d).then(S,r)},!(C.version>55&&"autoGainControl"in P.mediaDevices.getSupportedConstraints())){var E=function(S,r,t){r in S&&!(t in S)&&(S[t]=S[r],delete S[r])},L=P.mediaDevices.getUserMedia.bind(P.mediaDevices);if(P.mediaDevices.getUserMedia=function(d){return"object"===(typeof d>"u"?"undefined":b(d))&&"object"===b(d.audio)&&(d=JSON.parse(JSON.stringify(d)),E(d.audio,"autoGainControl","mozAutoGainControl"),E(d.audio,"noiseSuppression","mozNoiseSuppression")),L(d)},_&&_.prototype.getSettings){var x=_.prototype.getSettings;_.prototype.getSettings=function(){var d=x.apply(this,arguments);return E(d,"mozAutoGainControl","autoGainControl"),E(d,"mozNoiseSuppression","noiseSuppression"),d}}if(_&&_.prototype.applyConstraints){var I=_.prototype.applyConstraints;_.prototype.applyConstraints=function(d){return"audio"===this.kind&&"object"===(typeof d>"u"?"undefined":b(d))&&(d=JSON.parse(JSON.stringify(d)),E(d,"autoGainControl","mozAutoGainControl"),E(d,"noiseSuppression","mozNoiseSuppression")),I.apply(this,[d])}}}};var n=function i(f){if(f&&f.__esModule)return f;var C={};if(null!=f)for(var P in f)Object.prototype.hasOwnProperty.call(f,P)&&(C[P]=f[P]);return C.default=f,C}(R("../utils"))},{"../utils":11}],10:[function(R,D,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(d){return typeof d}:function(d){return d&&"function"==typeof Symbol&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d};v.shimLocalStreamsAPI=function a(d){if("object"===(typeof d>"u"?"undefined":b(d))&&d.RTCPeerConnection){if("getLocalStreams"in d.RTCPeerConnection.prototype||(d.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in d.RTCPeerConnection.prototype)){var S=d.RTCPeerConnection.prototype.addTrack;d.RTCPeerConnection.prototype.addStream=function(t){var o=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(function(e){return S.call(o,e,t)}),t.getVideoTracks().forEach(function(e){return S.call(o,e,t)})},d.RTCPeerConnection.prototype.addTrack=function(t){for(var o=this,e=arguments.length,c=Array(e>1?e-1:0),u=1;u<e;u++)c[u-1]=arguments[u];return c&&c.forEach(function(m){o._localStreams?o._localStreams.includes(m)||o._localStreams.push(m):o._localStreams=[m]}),S.apply(this,arguments)}}"removeStream"in d.RTCPeerConnection.prototype||(d.RTCPeerConnection.prototype.removeStream=function(t){var o=this;this._localStreams||(this._localStreams=[]);var e=this._localStreams.indexOf(t);if(-1!==e){this._localStreams.splice(e,1);var c=t.getTracks();this.getSenders().forEach(function(u){c.includes(u.track)&&o.removeTrack(u)})}})}},v.shimRemoteStreamsAPI=function f(d){if("object"===(typeof d>"u"?"undefined":b(d))&&d.RTCPeerConnection&&("getRemoteStreams"in d.RTCPeerConnection.prototype||(d.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in d.RTCPeerConnection.prototype))){Object.defineProperty(d.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(t){var o=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(c){if(o._remoteStreams||(o._remoteStreams=[]),!o._remoteStreams.includes(c)){o._remoteStreams.push(c);var u=new Event("addstream");u.stream=c,o.dispatchEvent(u)}})})}});var S=d.RTCPeerConnection.prototype.setRemoteDescription;d.RTCPeerConnection.prototype.setRemoteDescription=function(){var t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!(t._remoteStreams.indexOf(e)>=0)){t._remoteStreams.push(e);var c=new Event("addstream");c.stream=e,t.dispatchEvent(c)}})}),S.apply(t,arguments)}}},v.shimCallbacksAPI=function C(d){if("object"===(typeof d>"u"?"undefined":b(d))&&d.RTCPeerConnection){var S=d.RTCPeerConnection.prototype,r=S.createOffer,t=S.createAnswer,o=S.setLocalDescription,e=S.setRemoteDescription,c=S.addIceCandidate;S.createOffer=function(p,l){var y=r.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return l?(y.then(p,l),Promise.resolve()):y},S.createAnswer=function(p,l){var y=t.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return l?(y.then(p,l),Promise.resolve()):y};var u=function(p,l,h){var y=o.apply(this,[p]);return h?(y.then(l,h),Promise.resolve()):y};S.setLocalDescription=u,S.setRemoteDescription=u=function(p,l,h){var y=e.apply(this,[p]);return h?(y.then(l,h),Promise.resolve()):y},S.addIceCandidate=u=function(p,l,h){var y=c.apply(this,[p]);return h?(y.then(l,h),Promise.resolve()):y}}},v.shimGetUserMedia=function P(d){var S=d&&d.navigator;if(S.mediaDevices&&S.mediaDevices.getUserMedia){var r=S.mediaDevices,t=r.getUserMedia.bind(r);S.mediaDevices.getUserMedia=function(o){return t(_(o))}}!S.getUserMedia&&S.mediaDevices&&S.mediaDevices.getUserMedia&&(S.getUserMedia=function(e,c,u){S.mediaDevices.getUserMedia(e).then(c,u)}.bind(S))},v.shimConstraints=_,v.shimRTCIceServerUrls=function E(d){if(d.RTCPeerConnection){var S=d.RTCPeerConnection;d.RTCPeerConnection=function(t,o){if(t&&t.iceServers){for(var e=[],c=0;c<t.iceServers.length;c++){var u=t.iceServers[c];!u.hasOwnProperty("urls")&&u.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),(u=JSON.parse(JSON.stringify(u))).urls=u.url,delete u.url,e.push(u)):e.push(t.iceServers[c])}t.iceServers=e}return new S(t,o)},d.RTCPeerConnection.prototype=S.prototype,"generateCertificate"in S&&Object.defineProperty(d.RTCPeerConnection,"generateCertificate",{get:function(){return S.generateCertificate}})}},v.shimTrackEventTransceiver=function L(d){"object"===(typeof d>"u"?"undefined":b(d))&&d.RTCTrackEvent&&"receiver"in d.RTCTrackEvent.prototype&&!("transceiver"in d.RTCTrackEvent.prototype)&&Object.defineProperty(d.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},v.shimCreateOfferLegacy=function x(d){var S=d.RTCPeerConnection.prototype.createOffer;d.RTCPeerConnection.prototype.createOffer=function(t){if(t){typeof t.offerToReceiveAudio<"u"&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);var o=this.getTransceivers().find(function(c){return"audio"===c.receiver.track.kind});!1===t.offerToReceiveAudio&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0===t.offerToReceiveAudio&&!o&&this.addTransceiver("audio",{direction:"recvonly"}),typeof t.offerToReceiveVideo<"u"&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);var e=this.getTransceivers().find(function(c){return"video"===c.receiver.track.kind});!1===t.offerToReceiveVideo&&e?"sendrecv"===e.direction?e.setDirection?e.setDirection("sendonly"):e.direction="sendonly":"recvonly"===e.direction&&(e.setDirection?e.setDirection("inactive"):e.direction="inactive"):!0===t.offerToReceiveVideo&&!e&&this.addTransceiver("video",{direction:"recvonly"})}return S.apply(this,arguments)}},v.shimAudioContext=function I(d){"object"!==(typeof d>"u"?"undefined":b(d))||d.AudioContext||(d.AudioContext=d.webkitAudioContext)};var n=function i(d){if(d&&d.__esModule)return d;var S={};if(null!=d)for(var r in d)Object.prototype.hasOwnProperty.call(d,r)&&(S[r]=d[r]);return S.default=d,S}(R("../utils"));function _(d){return d&&void 0!==d.video?Object.assign({},d,{video:n.compactObject(d.video)}):d}},{"../utils":11}],11:[function(R,D,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r};v.extractVersion=a,v.wrapPeerConnectionEvent=function f(r,t,o){if(r.RTCPeerConnection){var e=r.RTCPeerConnection.prototype,c=e.addEventListener;e.addEventListener=function(m,p){if(m!==t)return c.apply(this,arguments);var l=function(y){var g=o(y);g&&(p.handleEvent?p.handleEvent(g):p(g))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(p,l),c.apply(this,[m,l])};var u=e.removeEventListener;e.removeEventListener=function(m,p){if(m!==t||!this._eventMap||!this._eventMap[t])return u.apply(this,arguments);if(!this._eventMap[t].has(p))return u.apply(this,arguments);var l=this._eventMap[t].get(p);return this._eventMap[t].delete(p),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,u.apply(this,[m,l])},Object.defineProperty(e,"on"+t,{get:function(){return this["_on"+t]},set:function(p){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),p&&this.addEventListener(t,this["_on"+t]=p)},enumerable:!0,configurable:!0})}},v.disableLog=function C(r){return"boolean"!=typeof r?new Error("Argument type: "+(typeof r>"u"?"undefined":b(r))+". Please use a boolean."):(n=r,r?"adapter.js logging disabled":"adapter.js logging enabled")},v.disableWarnings=function P(r){return"boolean"!=typeof r?new Error("Argument type: "+(typeof r>"u"?"undefined":b(r))+". Please use a boolean."):(i=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))},v.log=function _(){if("object"===(typeof window>"u"?"undefined":b(window))){if(n)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}},v.deprecated=function E(r,t){i&&console.warn(r+" is deprecated, please use "+t+" instead.")},v.detectBrowser=function L(r){var t={browser:null,version:null};if(typeof r>"u"||!r.navigator)return t.browser="Not a browser.",t;var o=r.navigator;if(o.mozGetUserMedia)t.browser="firefox",t.version=a(o.userAgent,/Firefox\/(\d+)\./,1);else if(o.webkitGetUserMedia||!1===r.isSecureContext&&r.webkitRTCPeerConnection)t.browser="chrome",t.version=a(o.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!r.RTCPeerConnection||!o.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=a(o.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype}return t},v.compactObject=function I(r){return x(r)?Object.keys(r).reduce(function(t,o){var e=x(r[o]),c=e?I(r[o]):r[o],u=e&&!Object.keys(c).length;return void 0===c||u?t:Object.assign(t,function s(r,t,o){return t in r?Object.defineProperty(r,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[t]=o,r}({},o,c))},{}):r},v.walkStats=d,v.filterStats=function S(r,t,o){var e=o?"outbound-rtp":"inbound-rtp",c=new Map;if(null===t)return c;var u=[];return r.forEach(function(m){"track"===m.type&&m.trackIdentifier===t.id&&u.push(m)}),u.forEach(function(m){r.forEach(function(p){p.type===e&&p.trackId===m.id&&d(r,p,c)})}),c};var n=!0,i=!0;function a(r,t,o){var e=r.match(t);return e&&e.length>=o&&parseInt(e[o],10)}function x(r){return"[object Object]"===Object.prototype.toString.call(r)}function d(r,t,o){!t||o.has(t.id)||(o.set(t.id,t),Object.keys(t).forEach(function(e){e.endsWith("Id")?d(r,r.get(t[e]),o):e.endsWith("Ids")&&t[e].forEach(function(c){d(r,r.get(c),o)})}))}},{}],12:[function(R,D,v){"use strict";var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},s={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};s.localCName=s.generateIdentifier(),s.splitLines=function(n){return n.trim().split("\n").map(function(i){return i.trim()})},s.splitSections=function(n){return n.split("\nm=").map(function(a,f){return(f>0?"m="+a:a).trim()+"\r\n"})},s.getDescription=function(n){var i=s.splitSections(n);return i&&i[0]},s.getMediaSections=function(n){var i=s.splitSections(n);return i.shift(),i},s.matchPrefix=function(n,i){return s.splitLines(n).filter(function(a){return 0===a.indexOf(i)})},s.parseCandidate=function(n){for(var i=void 0,a={foundation:(i=0===n.indexOf("a=candidate:")?n.substring(12).split(" "):n.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]},f=8;f<i.length;f+=2)switch(i[f]){case"raddr":a.relatedAddress=i[f+1];break;case"rport":a.relatedPort=parseInt(i[f+1],10);break;case"tcptype":a.tcpType=i[f+1];break;case"ufrag":a.ufrag=i[f+1],a.usernameFragment=i[f+1];break;default:void 0===a[i[f]]&&(a[i[f]]=i[f+1])}return a},s.writeCandidate=function(n){var i=[];i.push(n.foundation);var a=n.component;i.push("rtp"===a?1:"rtcp"===a?2:a),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);var f=n.type;return i.push("typ"),i.push(f),"host"!==f&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&"tcp"===n.protocol.toLowerCase()&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},s.parseIceOptions=function(n){return n.substr(14).split(" ")},s.parseRtpMap=function(n){var i=n.substr(9).split(" "),a={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),a.name=i[0],a.clockRate=parseInt(i[1],10),a.channels=3===i.length?parseInt(i[2],10):1,a.numChannels=a.channels,a},s.writeRtpMap=function(n){var i=n.payloadType;void 0!==n.preferredPayloadType&&(i=n.preferredPayloadType);var a=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(1!==a?"/"+a:"")+"\r\n"},s.parseExtmap=function(n){var i=n.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},s.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&"sendrecv"!==n.direction?"/"+n.direction:"")+" "+n.uri+"\r\n"},s.parseFmtp=function(n){for(var i={},a=void 0,f=n.substr(n.indexOf(" ")+1).split(";"),C=0;C<f.length;C++)i[(a=f[C].trim().split("="))[0].trim()]=a[1];return i},s.writeFmtp=function(n){var i="",a=n.payloadType;if(void 0!==n.preferredPayloadType&&(a=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){var f=[];Object.keys(n.parameters).forEach(function(C){f.push(void 0!==n.parameters[C]?C+"="+n.parameters[C]:C)}),i+="a=fmtp:"+a+" "+f.join(";")+"\r\n"}return i},s.parseRtcpFb=function(n){var i=n.substr(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},s.writeRtcpFb=function(n){var i="",a=n.payloadType;return void 0!==n.preferredPayloadType&&(a=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(function(f){i+="a=rtcp-fb:"+a+" "+f.type+(f.parameter&&f.parameter.length?" "+f.parameter:"")+"\r\n"}),i},s.parseSsrcMedia=function(n){var i=n.indexOf(" "),a={ssrc:parseInt(n.substr(7,i-7),10)},f=n.indexOf(":",i);return f>-1?(a.attribute=n.substr(i+1,f-i-1),a.value=n.substr(f+1)):a.attribute=n.substr(i+1),a},s.parseSsrcGroup=function(n){var i=n.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(function(a){return parseInt(a,10)})}},s.getMid=function(n){var i=s.matchPrefix(n,"a=mid:")[0];if(i)return i.substr(6)},s.parseFingerprint=function(n){var i=n.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},s.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:s.matchPrefix(n+i,"a=fingerprint:").map(s.parseFingerprint)}},s.writeDtlsParameters=function(n,i){var a="a=setup:"+i+"\r\n";return n.fingerprints.forEach(function(f){a+="a=fingerprint:"+f.algorithm+" "+f.value+"\r\n"}),a},s.parseCryptoLine=function(n){var i=n.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},s.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+("object"===b(n.keyParams)?s.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+"\r\n"},s.parseCryptoKeyParams=function(n){if(0!==n.indexOf("inline:"))return null;var i=n.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},s.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},s.getCryptoParameters=function(n,i){return s.matchPrefix(n+i,"a=crypto:").map(s.parseCryptoLine)},s.getIceParameters=function(n,i){var a=s.matchPrefix(n+i,"a=ice-ufrag:")[0],f=s.matchPrefix(n+i,"a=ice-pwd:")[0];return a&&f?{usernameFragment:a.substr(12),password:f.substr(10)}:null},s.writeIceParameters=function(n){var i="a=ice-ufrag:"+n.usernameFragment+"\r\na=ice-pwd:"+n.password+"\r\n";return n.iceLite&&(i+="a=ice-lite\r\n"),i},s.parseRtpParameters=function(n){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},f=s.splitLines(n)[0].split(" "),C=3;C<f.length;C++){var P=f[C],_=s.matchPrefix(n,"a=rtpmap:"+P+" ")[0];if(_){var E=s.parseRtpMap(_),L=s.matchPrefix(n,"a=fmtp:"+P+" ");switch(E.parameters=L.length?s.parseFmtp(L[0]):{},E.rtcpFeedback=s.matchPrefix(n,"a=rtcp-fb:"+P+" ").map(s.parseRtcpFb),i.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(E.name.toUpperCase())}}}return s.matchPrefix(n,"a=extmap:").forEach(function(x){i.headerExtensions.push(s.parseExtmap(x))}),i},s.writeRtpDescription=function(n,i){var a="";a+="m="+n+" ",a+=i.codecs.length>0?"9":"0",a+=" UDP/TLS/RTP/SAVPF ",a+=i.codecs.map(function(C){return void 0!==C.preferredPayloadType?C.preferredPayloadType:C.payloadType}).join(" ")+"\r\n",a+="c=IN IP4 0.0.0.0\r\n",a+="a=rtcp:9 IN IP4 0.0.0.0\r\n",i.codecs.forEach(function(C){a+=s.writeRtpMap(C),a+=s.writeFmtp(C),a+=s.writeRtcpFb(C)});var f=0;return i.codecs.forEach(function(C){C.maxptime>f&&(f=C.maxptime)}),f>0&&(a+="a=maxptime:"+f+"\r\n"),i.headerExtensions&&i.headerExtensions.forEach(function(C){a+=s.writeExtmap(C)}),a},s.parseRtpEncodingParameters=function(n){var i=[],a=s.parseRtpParameters(n),f=-1!==a.fecMechanisms.indexOf("RED"),C=-1!==a.fecMechanisms.indexOf("ULPFEC"),P=s.matchPrefix(n,"a=ssrc:").map(function(I){return s.parseSsrcMedia(I)}).filter(function(I){return"cname"===I.attribute}),_=P.length>0&&P[0].ssrc,E=void 0,L=s.matchPrefix(n,"a=ssrc-group:FID").map(function(I){return I.substr(17).split(" ").map(function(S){return parseInt(S,10)})});L.length>0&&L[0].length>1&&L[0][0]===_&&(E=L[0][1]),a.codecs.forEach(function(I){if("RTX"===I.name.toUpperCase()&&I.parameters.apt){var d={ssrc:_,codecPayloadType:parseInt(I.parameters.apt,10)};_&&E&&(d.rtx={ssrc:E}),i.push(d),f&&((d=JSON.parse(JSON.stringify(d))).fec={ssrc:_,mechanism:C?"red+ulpfec":"red"},i.push(d))}}),0===i.length&&_&&i.push({ssrc:_});var x=s.matchPrefix(n,"b=");return x.length&&(x=0===x[0].indexOf("b=TIAS:")?parseInt(x[0].substr(7),10):0===x[0].indexOf("b=AS:")?1e3*parseInt(x[0].substr(5),10)*.95-16e3:void 0,i.forEach(function(I){I.maxBitrate=x})),i},s.parseRtcpParameters=function(n){var i={},a=s.matchPrefix(n,"a=ssrc:").map(function(P){return s.parseSsrcMedia(P)}).filter(function(P){return"cname"===P.attribute})[0];a&&(i.cname=a.value,i.ssrc=a.ssrc);var f=s.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=f.length>0,i.compound=0===f.length;var C=s.matchPrefix(n,"a=rtcp-mux");return i.mux=C.length>0,i},s.writeRtcpParameters=function(n){var i="";return n.reducedSize&&(i+="a=rtcp-rsize\r\n"),n.mux&&(i+="a=rtcp-mux\r\n"),void 0!==n.ssrc&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+"\r\n"),i},s.parseMsid=function(n){var i=void 0,a=s.matchPrefix(n,"a=msid:");if(1===a.length)return{stream:(i=a[0].substr(7).split(" "))[0],track:i[1]};var f=s.matchPrefix(n,"a=ssrc:").map(function(C){return s.parseSsrcMedia(C)}).filter(function(C){return"msid"===C.attribute});return f.length>0?{stream:(i=f[0].value.split(" "))[0],track:i[1]}:void 0},s.parseSctpDescription=function(n){var i=s.parseMLine(n),a=s.matchPrefix(n,"a=max-message-size:"),f=void 0;a.length>0&&(f=parseInt(a[0].substr(19),10)),isNaN(f)&&(f=65536);var C=s.matchPrefix(n,"a=sctp-port:");if(C.length>0)return{port:parseInt(C[0].substr(12),10),protocol:i.fmt,maxMessageSize:f};var P=s.matchPrefix(n,"a=sctpmap:");if(P.length>0){var _=P[0].substr(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:f}}},s.writeSctpDescription=function(n,i){var a=[];return a="DTLS/SCTP"!==n.protocol?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+i.port+"\r\n"]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+i.port+" "+i.protocol+" 65535\r\n"],void 0!==i.maxMessageSize&&a.push("a=max-message-size:"+i.maxMessageSize+"\r\n"),a.join("")},s.generateSessionId=function(){return Math.random().toString().substr(2,21)},s.writeSessionBoilerplate=function(n,i,a){var C=void 0!==i?i:2;return"v=0\r\no="+(a||"thisisadapterortc")+" "+(n||s.generateSessionId())+" "+C+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},s.getDirection=function(n,i){for(var a=s.splitLines(n),f=0;f<a.length;f++)switch(a[f]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[f].substr(2)}return i?s.getDirection(i):"sendrecv"},s.getKind=function(n){return s.splitLines(n)[0].split(" ")[0].substr(2)},s.isRejected=function(n){return"0"===n.split(" ",2)[1]},s.parseMLine=function(n){var a=s.splitLines(n)[0].substr(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},s.parseOLine=function(n){var a=s.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},s.isValidSDP=function(n){if("string"!=typeof n||0===n.length)return!1;for(var i=s.splitLines(n),a=0;a<i.length;a++)if(i[a].length<2||"="!==i[a].charAt(1))return!1;return!0},"object"===(typeof D>"u"?"undefined":b(D))&&(D.exports=s)},{}]},{},[1])(1)});var WebRtcStreamer=function(){var N=function(A,R){this.videoElement="string"==typeof A?document.getElementById(A):A,this.srvurl=R||location.protocol+"//"+window.location.hostname+":"+window.location.port,this.pc=null,this.mediaConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.iceServers=null,this.earlyCandidates=[]};return N.prototype._handleHttpErrors=function(T){if(!T.ok)throw Error(T.statusText);return T},N.prototype.connect=function(T,A,R,D){this.disconnect(),this.iceServers?this.onReceiveGetIceServers(this.iceServers,T,A,R,D):(console.log("Get IceServers"),fetch(this.srvurl+"/api/getIceServers").then(this._handleHttpErrors).then(v=>v.json()).then(v=>this.onReceiveGetIceServers(v,T,A,R,D)).catch(v=>this.onError("getIceServers "+v)))},N.prototype.disconnect=function(){if(this.videoElement?.srcObject&&this.videoElement.srcObject.getTracks().forEach(T=>{T.stop(),this.videoElement.srcObject.removeTrack(T)}),this.pc){fetch(this.srvurl+"/api/hangup?peerid="+this.pc.peerid).then(this._handleHttpErrors).catch(T=>this.onError("hangup "+T));try{this.pc.close()}catch(T){console.log("Failure close peer connection:"+T)}this.pc=null}},N.prototype.onReceiveGetIceServers=function(T,A,R,D,v){this.iceServers=T,this.pcConfig=T||{iceServers:[]};try{this.createPeerConnection();var b=this.srvurl+"/api/call?peerid="+this.pc.peerid+"&url="+encodeURIComponent(A);R&&(b+="&audiourl="+encodeURIComponent(R)),D&&(b+="&options="+encodeURIComponent(D)),v&&this.pc.addStream(v),this.earlyCandidates.length=0,this.pc.createOffer(this.mediaConstraints).then(s=>{console.log("Create offer:"+JSON.stringify(s)),this.pc.setLocalDescription(s).then(()=>{fetch(b,{method:"POST",body:JSON.stringify(s)}).then(this._handleHttpErrors).then(n=>n.json()).catch(n=>this.onError("call "+n)).then(n=>this.onReceiveCall(n)).catch(n=>this.onError("call "+n))},n=>{console.log("setLocalDescription error:"+JSON.stringify(n))})},s=>{alert("Create offer error:"+JSON.stringify(s))})}catch(s){this.disconnect(),alert("connect error: "+s)}},N.prototype.getIceCandidate=function(){fetch(this.srvurl+"/api/getIceCandidate?peerid="+this.pc.peerid).then(this._handleHttpErrors).then(T=>T.json()).then(T=>this.onReceiveCandidate(T)).catch(T=>this.onError("getIceCandidate "+T))},N.prototype.createPeerConnection=function(){console.log("createPeerConnection  config: "+JSON.stringify(this.pcConfig)),this.pc=new RTCPeerConnection(this.pcConfig);var T=this.pc;T.peerid=Math.random(),T.onicecandidate=R=>this.onIceCandidate(R),T.onaddstream=R=>this.onAddStream(R),T.oniceconnectionstatechange=R=>{console.log("oniceconnectionstatechange  state: "+T.iceConnectionState),this.videoElement&&("connected"===T.iceConnectionState?this.videoElement.style.opacity="1.0":"disconnected"===T.iceConnectionState?this.videoElement.style.opacity="0.25":"failed"===T.iceConnectionState||"closed"===T.iceConnectionState?this.videoElement.style.opacity="0.5":"new"===T.iceConnectionState&&this.getIceCandidate())},T.ondatachannel=function(R){console.log("remote datachannel created:"+JSON.stringify(R)),R.channel.onopen=function(){console.log("remote datachannel open"),this.send("remote channel openned")},R.channel.onmessage=function(D){console.log("remote datachannel recv:"+JSON.stringify(D.data))}},T.onicegatheringstatechange=function(){"complete"===T.iceGatheringState&&T.getReceivers().forEach(D=>{D.track&&"video"===D.track.kind&&console.log("codecs:"+JSON.stringify(D.getParameters().codecs))})};try{var A=T.createDataChannel("ClientDataChannel");A.onopen=function(){console.log("local datachannel open"),this.send("local channel openned")},A.onmessage=function(R){console.log("local datachannel recv:"+JSON.stringify(R.data))}}catch(R){console.log("Cannor create datachannel error: "+R)}return console.log("Created RTCPeerConnnection with config: "+JSON.stringify(this.pcConfig)),T},N.prototype.onIceCandidate=function(T){T.candidate?this.pc.currentRemoteDescription?this.addIceCandidate(this.pc.peerid,T.candidate):this.earlyCandidates.push(T.candidate):console.log("End of candidates.")},N.prototype.addIceCandidate=function(T,A){fetch(this.srvurl+"/api/addIceCandidate?peerid="+T,{method:"POST",body:JSON.stringify(A)}).then(this._handleHttpErrors).then(R=>R.json()).then(R=>{console.log("addIceCandidate ok:"+R)}).catch(R=>this.onError("addIceCandidate "+R))},N.prototype.onAddStream=function(T){console.log("Remote track added:"+JSON.stringify(T)),console.log("\u{1f680} ~ file: webrtcstreamer.js:242 ~ WebRtcStreamer ~ this.videoElement:",this.videoElement),this.videoElement.srcObject=T.stream;var A=this.videoElement.play();void 0!==A&&A.catch(R=>{console.warn("error:"+R),this.videoElement.setAttribute("controls",!0)})},N.prototype.onReceiveCall=function(T){console.log("offer: "+JSON.stringify(T));var A=new RTCSessionDescription(T);this.pc.setRemoteDescription(A).then(()=>{for(console.log("setRemoteDescription ok");this.earlyCandidates.length;){var R=this.earlyCandidates.shift();this.addIceCandidate(this.pc.peerid,R)}this.getIceCandidate()},R=>{console.log("setRemoteDescription error:"+JSON.stringify(R))})},N.prototype.onReceiveCandidate=function(T){if(console.log("candidate: "+JSON.stringify(T)),T){for(var A=0;A<T.length;A++){var R=new RTCIceCandidate(T[A]);console.log("Adding ICE candidate :"+JSON.stringify(R)),this.pc.addIceCandidate(R).then(()=>{console.log("addIceCandidate OK")},D=>{console.log("addIceCandidate error:"+JSON.stringify(D))})}this.pc.addIceCandidate()}},N.prototype.onError=function(T){console.log("onError:"+T)},N}();typeof window<"u"&&typeof window.document<"u"&&(window.WebRtcStreamer=WebRtcStreamer),typeof module<"u"&&typeof module.exports<"u"&&(module.exports=WebRtcStreamer);